From 7f7fdc0ca8f389b7409e4793ff08a3597f2e1a2c Mon Sep 17 00:00:00 2001
From: Ryan Gonzalez <rymg19@gmail.com>
Date: Wed, 31 Aug 2022 10:09:01 -0500
Subject: [PATCH] Clang build script: Don't build against the sysroot

---
 tools/clang/scripts/build.py | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

diff --git a/tools/clang/scripts/build.py b/tools/clang/scripts/build.py
index 0edf539746a04..a84b9faefcf7c 100755
--- a/tools/clang/scripts/build.py
+++ b/tools/clang/scripts/build.py
@@ -874,7 +874,7 @@ def main():
   ninja_dir = os.path.join(THIRD_PARTY_DIR, 'ninja')
   os.environ['PATH'] = ninja_dir + os.pathsep + os.environ.get('PATH', '')
 
-  if sys.platform.startswith('linux'):
+  if sys.platform.startswith('linux') and False:
     with timer.time('get sysroots'):
       sysroot_amd64 = DownloadDebianSysroot('amd64', args.skip_checkout)
       sysroot_i386 = DownloadDebianSysroot('i386', args.skip_checkout)
@@ -981,7 +981,7 @@ def main():
     if sys.platform.startswith('linux'):
       base_cmake_args += [ '-DLLVM_STATIC_LINK_CXX_STDLIB=ON' ]
 
-  if sys.platform.startswith('linux'):
+  if sys.platform.startswith('linux') and False:
     # Add the sysroot to base_cmake_args.
     if platform.machine() == 'aarch64':
       base_cmake_args.append('-DCMAKE_SYSROOT=' + sysroot_arm64)
@@ -1314,7 +1314,7 @@ def main():
   if sys.platform.startswith('linux'):
     runtimes_triples_args['i386-unknown-linux-gnu'] = {
         "args": [
-            'CMAKE_SYSROOT=%s' % sysroot_i386,
+            # 'CMAKE_SYSROOT=%s' % sysroot_i386,
             # TODO(crbug.com/40242553): pass proper flags to i386 tests so they
             # compile correctly
             'LLVM_INCLUDE_TESTS=OFF',
@@ -1326,7 +1326,7 @@ def main():
     }
     runtimes_triples_args['x86_64-unknown-linux-gnu'] = {
         "args": [
-            'CMAKE_SYSROOT=%s' % sysroot_amd64,
+            # 'CMAKE_SYSROOT=%s' % sysroot_amd64,
         ],
         "profile": True,
         "sanitizers": True,
@@ -1340,7 +1340,7 @@ def main():
     # Maybe it should work for builtins too?
     runtimes_triples_args['armv7-unknown-linux-gnueabihf'] = {
         "args": [
-            'CMAKE_SYSROOT=%s' % sysroot_arm,
+            # 'CMAKE_SYSROOT=%s' % sysroot_arm,
             # Can't run tests on x86 host.
             'LLVM_INCLUDE_TESTS=OFF',
         ],
@@ -1351,7 +1351,7 @@ def main():
     }
     runtimes_triples_args['aarch64-unknown-linux-gnu'] = {
         "args": [
-            'CMAKE_SYSROOT=%s' % sysroot_arm64,
+            # 'CMAKE_SYSROOT=%s' % sysroot_arm64,
             # Can't run tests on x86 host.
             'LLVM_INCLUDE_TESTS=OFF',
         ],
@@ -1362,7 +1362,7 @@ def main():
     }
     runtimes_triples_args['riscv64-unknown-linux-gnu'] = {
         "args": [
-            'CMAKE_SYSROOT=%s' % sysroot_riscv64,
+            # 'CMAKE_SYSROOT=%s' % sysroot_riscv64,
             # Can't run tests on x86 host.
             'LLVM_INCLUDE_TESTS=OFF',
         ],
-- 
2.51.2

